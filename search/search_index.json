{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Computa\u00e7\u00e3o em Nuvem","text":"Edi\u00e7\u00e3o <p>2025.1</p>"},{"location":"#kit-m","title":"KIT-M","text":"<p>Samuel Jabes</p> <p>Lucas Filizola</p>"},{"location":"#entregas","title":"Entregas","text":"<ul> <li> Roteiro 1 - Data 23/02/2025</li> <li> Roteiro 2</li> <li> Roteiro 3</li> <li> Roteiro 4</li> <li> Projeto</li> </ul>"},{"location":"#referencias","title":"Refer\u00eancias","text":"<p>Material for MkDocs</p>"},{"location":"projeto/main/","title":"Simple Authentication API","text":"<p>Este projeto implementa uma API RESTful em Python (FastAPI) capaz de cadastrar e autenticar usu\u00e1rios, al\u00e9m de disponibilizar um endpoint de consulta a dados de terceiros via web scraping.</p>"},{"location":"projeto/main/#sumario","title":"Sum\u00e1rio","text":"<ol> <li>Vis\u00e3o Geral</li> <li>Endpoints</li> <li>Registro de Usu\u00e1rio</li> <li>Autentica\u00e7\u00e3o de Usu\u00e1rio</li> <li>Consulta de Dados</li> <li>Como Executar (Etapa\u00a01)</li> <li>Estrutura de Diret\u00f3rios</li> <li>Docker Hub</li> <li>compose.yaml Final</li> <li>Rodando Localmente</li> <li>Vari\u00e1veis de Ambiente</li> <li>Link Docker Hub</li> <li>Screenshots</li> <li>V\u00eddeo de Demonstra\u00e7\u00e3o</li> </ol>"},{"location":"projeto/main/#visao-geral","title":"Vis\u00e3o Geral","text":"<p>A Simple Authentication API fornece:</p> <ul> <li>Registro de usu\u00e1rios com armazenamento seguro de senhas (usando <code>bcrypt</code>).</li> <li>Login de usu\u00e1rios, retornando um JWT para autentica\u00e7\u00e3o.</li> <li>Consulta protegida (<code>GET /consultar</code>), que executa scraping em uma fonte externa para trazer dados atualizados (por exemplo, cota\u00e7\u00f5es de moedas).</li> </ul> <p>A aplica\u00e7\u00e3o segue boas pr\u00e1ticas de seguran\u00e7a:</p> <ul> <li>Nunca armazena senhas em texto claro.</li> <li>JWT para proteger endpoints.</li> <li>Conex\u00e3o ao PostgreSQL via vari\u00e1veis de ambiente.</li> </ul>"},{"location":"projeto/main/#endpoints","title":"Endpoints","text":""},{"location":"projeto/main/#registro-de-usuario","title":"Registro de Usu\u00e1rio","text":"<pre><code>POST /registrar\nContent-Type: application/json\n</code></pre> <p>Request</p> <pre><code>{\n  \"nome\": \"Samuel Jabes\",\n  \"email\": \"samueljcc@al.insper.edu.br\",\n  \"senha\": \"sam1234\"\n}\n</code></pre> <p>Response (201)</p> <pre><code>{\n  \"jwt\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InNhbXVlbGpjY0BhbC5pbnNwZXIuZWR1LmJyIiwicGFzc3dvcmQiOiJzYW0xMjM0In0.H3awAOszz5pQReXIFQtC6wxk0kfwlOjtXFh9QAzut8c\"\n}\n</code></pre> <pre><code>sequenceDiagram\n    autonumber\n    actor Samuel\n    Samuel-&gt;&gt;+App: POST /registrar\n    App-&gt;&gt;+Postgres: SELECT * FROM users WHERE email = Samuel.email\n    alt email j\u00e1 existe\n      Postgres--&gt;&gt;App: 409 Conflict\n      App--&gt;&gt;Samuel: 409 Conflict\n    else email n\u00e3o existe\n      App-&gt;&gt;Postgres: INSERT user(hash_password)\n      App-&gt;&gt;App: gera JWT\n      App--&gt;&gt;-Samuel: 201 Created + { jwt }\n    end</code></pre> <p>Nota: Armazenamos apenas o hash da senha, nunca o texto claro.</p>"},{"location":"projeto/main/#autenticacao-de-usuario","title":"Autentica\u00e7\u00e3o de Usu\u00e1rio","text":"<pre><code>POST /login\nContent-Type: application/json\n</code></pre> <p>Request</p> <pre><code>{\n  \"email\": \"samueljcc@al.insper.edu.br\",\n  \"senha\": \"sam1234\"\n}\n</code></pre> <p>Response (200)</p> <pre><code>{\n  \"jwt\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InNhbXVlbGpjY0BhbC5pbnNwZXIuZWR1LmJyIiwicGFzc3dvcmQiOiJzYW0xMjM0In0.H3awAOszz5pQReXIFQtC6wxk0kfwlOjtXFh9QAzut8c\"\n}\n</code></pre> <pre><code>sequenceDiagram\n  autonumber\n  actor Samuel\n  participant App\n  participant Postgres\n\n  Samuel-&gt;&gt;+App: POST /login\n  App-&gt;&gt;+Postgres: SELECT hash_password FROM users WHERE email = Samuel.email\n\n  alt usu\u00e1rio n\u00e3o encontrado ou senha inv\u00e1lida\n    Postgres--&gt;&gt;App: (nenhum registro)     &lt;!-- retorna sem desativar Postgres --&gt;\n    App--&gt;&gt;Samuel: 401 Unauthorized         &lt;!-- retorna sem desativar App --&gt;\n  else credenciais v\u00e1lidas\n    Postgres--&gt;&gt;App: hash correto\n    App-&gt;&gt;App: gera JWT\n    App--&gt;&gt;Samuel: 200 OK + { jwt }\n  end\n\n  deactivate Postgres\n  deactivate App\n</code></pre>"},{"location":"projeto/main/#consulta-de-dados","title":"Consulta de Dados","text":"<p>GET /consultar (protegido)</p> <p>Header</p> <pre><code>Authorization: Bearer &lt;JWT&gt;\n</code></pre> <p>Response (200) \u2013 exemplo de cota\u00e7\u00f5es USD\u2192BRL e EUR\u2192BRL via scraping:</p> <pre><code>{\n  \"USD_TO_BRL\": 5.632,\n  \"EUR_TO_BRL\": 6.417\n}\n</code></pre> <pre><code>sequenceDiagram\n  autonumber\n  actor Samuel\n  participant App\n  participant Internet\n\n  Samuel-&gt;&gt;+App: GET /consultar (JWT)\n  App-&gt;&gt;App: valida JWT\n\n  alt JWT inv\u00e1lido\n    App--&gt;&gt;Samuel: 403 Forbidden\n  else JWT v\u00e1lido\n    App-&gt;&gt;+Internet: scrap Wise USD\u2192BRL\n    Internet--&gt;&gt;-App: usd_brl\n    App-&gt;&gt;+Internet: scrap Wise EUR\u2192BRL\n    Internet--&gt;&gt;-App: eur_brl\n    App--&gt;&gt;-Samuel: 200 OK + { usd_brl, eur_brl }\n  end\n</code></pre>"},{"location":"projeto/main/#detalhes-do-web-scraping","title":"Detalhes do Web Scraping","text":"<p>Para obter os valores de c\u00e2mbio na Wise, seguimos este processo:</p> <ol> <li> <p>Acesse a p\u00e1gina de convers\u00e3o desejada, por exemplo:</p> </li> <li> <p>D\u00f3lar \u2192 Real: <code>https://wise.com/us/currency-converter/usd-to-brl-rate</code></p> </li> <li> <p>Euro \u2192 Real:  <code>https://wise.com/br/currency-converter/eur-to-brl</code></p> </li> <li> <p>Abra as ferramentas de desenvolvedor do navegador (F12) e utilize o Inspecionar para localizar o elemento que exibe o valor convertido.</p> </li> <li> <p>Ao passar o cursor sobre a caixa de valor no HTML, verificou-se que o elemento \u00e9 um <code>&lt;span&gt;</code> com a classe <code>text-success</code>.</p> </li> <li> <p>No c\u00f3digo Python, usamos Requests para obter o HTML est\u00e1tico da p\u00e1gina e BeautifulSoup para fazer o parse.</p> </li> <li> <p>Com <code>soup.select_one(\"span.text-success\")</code>, capturamos esse elemento. Em seguida:</p> </li> </ol> <pre><code>span = soup.select_one(\"span.text-success\")\nrate_text = span.get_text(strip=True).replace(\",\", \".\")\nvalor = float(rate_text)\n</code></pre> <ol> <li>Adicionamos <code>valor</code> ao dicion\u00e1rio de respostas sob as chaves <code>USD_TO_BRL</code> e <code>EUR_TO_BRL</code>.</li> </ol> <p>Este m\u00e9todo se aplica a qualquer moeda suportada pelo conversor da Wise, bastando ajustar a URL e reutilizar a mesma l\u00f3gica de sele\u00e7\u00e3o da classe <code>text-success</code>.</p>"},{"location":"projeto/main/#como-executar-etapa-1","title":"Como Executar (Etapa\u00a01)","text":""},{"location":"projeto/main/#estrutura-de-diretorios","title":"Estrutura de Diret\u00f3rios","text":"<pre><code>./\n\u251c\u2500\u2500 app.py\n\u251c\u2500\u2500 requirements.txt\n\u251c\u2500\u2500 sql/\n\u2502   \u2514\u2500\u2500 users.sql\n\u251c\u2500\u2500 models/\n\u2502   \u2514\u2500\u2500 login_schema.py\n\u2502   \u2514\u2500\u2500 register_user_schema.py\n\u2502   \u2514\u2500\u2500 user_schema.py\n\u251c\u2500\u2500 Dockerfile        # para a aplica\u00e7\u00e3o FastAPI\n\u251c\u2500\u2500 Dockerfile-db     # para o Postgres (executa users.sql)\n\u251c\u2500\u2500 compose.yaml      # orquestra app + database\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 .env\n</code></pre>"},{"location":"projeto/main/#docker-hub","title":"Docker Hub","text":"<p>A imagem da API est\u00e1 publicada como:</p> <pre><code>samueljabes/simple_authentication_api:v1.0.1\n</code></pre>"},{"location":"projeto/main/#composeyaml-final","title":"compose.yaml Final","text":"<p>O arquivo <code>compose.yaml</code>, na raiz do projeto, usa apenas imagens do Docker Hub:</p> <pre><code>services:\n  database:\n    build:\n      context: .\n      dockerfile: Dockerfile-db\n    container_name: database\n    restart: always\n    env_file:\n      - .env\n    environment:\n      POSTGRES_USER: ${POSTGRES_USER}\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}\n      POSTGRES_DB: ${POSTGRES_DB}\n\n  app:\n    image: samueljabes/simple_authentication_api:v1.0.1\n    ports:\n      - \"5000:5000\"\n    env_file:\n      - .env\n    depends_on:\n      - database\n</code></pre>"},{"location":"projeto/main/#rodando-localmente","title":"Rodando Localmente","text":"<ol> <li>Configure (ou crie) o arquivo <code>.env</code> na raiz:    <pre><code>POSTGRES_USER=meuusuario\nPOSTGRES_PASSWORD=minhasenha\nPOSTGRES_DB=meubanco\nSECRET_KEY=SUA_CHAVE_JWT\n</code></pre></li> <li>Execute:    <pre><code>docker compose down -v       # limpa containers + volume\ndocker compose pull          # puxa a imagem da API (v1.0.1)\ndocker compose up -d         # sobe app + database\n</code></pre></li> <li>Acesse <code>http://localhost:5000/docs</code> para testar.</li> </ol>"},{"location":"projeto/main/#variaveis-de-ambiente","title":"Vari\u00e1veis de Ambiente","text":"<ul> <li><code>POSTGRES_USER</code>, <code>POSTGRES_PASSWORD</code>, <code>POSTGRES_DB</code>: credenciais do banco.</li> <li><code>POSTGRES_HOST</code> e <code>POSTGRES_PORT</code> n\u00e3o s\u00e3o necess\u00e1rios no <code>compose.yaml</code> final, pois usamos a mesma stack.</li> <li><code>SECRET_KEY</code>: chave para assinar JWT.</li> </ul> <p>Nota de Seguran\u00e7a: Em produ\u00e7\u00e3o, n\u00e3o exponha portas de banco e n\u00e3o inclua credenciais no reposit\u00f3rio.</p>"},{"location":"projeto/main/#link-docker-hub","title":"Link Docker Hub","text":"<p>https://hub.docker.com/r/samueljabes/simple_authentication_api</p>"},{"location":"projeto/main/#publicacao-no-docker-hub","title":"Publica\u00e7\u00e3o no Docker Hub","text":"<p>Para publicar a imagem com a tag <code>latest</code>: <pre><code># Autentica no Docker Hub\ndocker login\n\n# Build e push da tag latest\ndocker build -t samueljabes/simple_authentication_api:latest .\ndocker push samueljabes/simple_authentication_api:latest\n</code></pre></p> <p>Para criar e publicar uma nova tag <code>v1.0.1</code> a partir da imagem <code>latest</code>: <pre><code># Retag da imagem latest para v1.0.1\ndocker tag samueljabes/simple_authentication_api:latest samueljabes/simple_authentication_api:v1.0.1\n\n# Push da nova tag\ndocker push samueljabes/simple_authentication_api:v1.0.1\n</code></pre></p> <p>Para executar localmente usando a tag <code>v1.0.1</code>: <pre><code># Puxa a imagem v1.0.1 do Docker Hub\ndocker pull samueljabes/simple_authentication_api:v1.0.1\n\ndocker compose pull\n\ndocker compose up -d\n</code></pre></p>"},{"location":"projeto/main/#screenshots","title":"Screenshots","text":""},{"location":"projeto/main/#tela-de-registro-de-usuario","title":"Tela de Registro de Usu\u00e1rio","text":"<p> Formulario de registro com payload e resposta de JWT.</p>"},{"location":"projeto/main/#tela-de-login-de-usuario","title":"Tela de Login de Usu\u00e1rio","text":"<p> Formulario de login exibindo o campo de email, senha e resposta de JWT.</p>"},{"location":"projeto/main/#tela-de-consulta-protegida","title":"Tela de Consulta Protegida","text":"<p> Endpoint <code>/consultar</code> solicitando o token JWT e retornando as cota\u00e7\u00f5es.</p>"},{"location":"projeto/main/#video-de-demonstracao","title":"V\u00eddeo de Demonstra\u00e7\u00e3o","text":"<p>Clique na imagem acima para assistir ao v\u00eddeo demonstrando o fluxo de registro, login e consulta.</p>"},{"location":"roteiro1/main/","title":"Roteiro 1 - Cloud Computing","text":""},{"location":"roteiro1/main/#introducao","title":"Introdu\u00e7\u00e3o","text":"<p>Este roteiro tem como principais objetivos:</p> <ul> <li>Entender os conceitos b\u00e1sicos sobre uma plataforma de gerenciamento de hardware</li> <li>Introduzir conceitos b\u00e1sicos sobre redes de computadores</li> </ul> <p>O Metal-as-a-Service (MaaS) \u00e9 uma solu\u00e7\u00e3o de gerenciamento de infraestrutura que trata servidores f\u00edsicos como m\u00e1quinas virtuais na nuvem. Ele permite provisionar, gerenciar e controlar servidores f\u00edsicos atrav\u00e9s de uma interface web amig\u00e1vel, tornando poss\u00edvel implantar sistemas operacionais rapidamente e gerenciar infraestruturas complexas de forma centralizada.</p>"},{"location":"roteiro1/main/#pre-requisitos","title":"Pr\u00e9-requisitos","text":"<ul> <li>Realizar a leitura sobre o MaaS: [https://maas.io/]</li> <li>Familiaridade b\u00e1sica com conceitos de redes e virtualiza\u00e7\u00e3o</li> </ul>"},{"location":"roteiro1/main/#material-do-kit","title":"Material do Kit","text":"<p>O grupo contar\u00e1 com os seguintes itens:</p> <ul> <li>1 NUC (main) com 10GB e 1 SSD (120GB)</li> <li>1 NUC (server1) com 12GB e 1 SSD (120GB)</li> <li>1 NUC (server2) com 16GB e 2 SSD (120GB+120GB)</li> <li>3 NUCs (server3, server4 e server5) com 32GB e 2 SSD (120GB+120GB)</li> <li>1 Switch DLink DSG-1210-28 de 28 portas</li> <li>1 Roteador TP-Link TL-R470T+</li> </ul>"},{"location":"roteiro1/main/#configuracao-de-rede","title":"Configura\u00e7\u00e3o de Rede","text":"<p>Cada grupo tem \u00e0 disposi\u00e7\u00e3o um ponto de rede (cabo preto) com sa\u00edda para a rede interna da faculdade, e cada kit possui um IP de entrada que pode ser verificado no dashboard do roteador.</p>"},{"location":"roteiro1/main/#politica-de-senhas","title":"Pol\u00edtica de Senhas","text":"<p>Todas as senhas do sistema devem seguir o crit\u00e9rio:</p> <ul> <li>Utilizar a palavra 'cloud' + a letra do kit min\u00fascula</li> <li>Por exemplo: 'cloudz' para o kit Z</li> <li>Usar a mesma senha para todos os servi\u00e7os que exigem cadastramento</li> <li>N\u00c3O alterar nenhuma senha que j\u00e1 esteja pr\u00e9-cadastrada</li> </ul> <p>Para o nosso caso, as senhas eram <code>cloudm</code>.</p>"},{"location":"roteiro1/main/#parte-1-infraestrutura","title":"Parte 1: Infraestrutura","text":""},{"location":"roteiro1/main/#instalando-o-ubuntu","title":"Instalando o Ubuntu","text":"<p>Procure tutoriais de como instalar o Sistema Operacional Ubuntu server, utilize um pen drive para baixar a imagem e criar um pendrive para boot da instalacao.</p> <ul> <li>Instale o Ubuntu Server 22.04 LTS na NUC main:<ul> <li>hostname: main</li> <li>login: cloud</li> <li>senha: (cloud + letra do kit)</li> <li>IP fixo: 172.16.0.3</li> <li>Name Servers (DNS): 172.20.129.131</li> </ul> </li> </ul>"},{"location":"roteiro1/main/#instalando-o-maas","title":"Instalando o MaaS","text":"<ul> <li>O MAAS possui diversas vers\u00f5es, iremos utilizar a \"stable\" 3.5.3 link para visualizar o time line</li> <li>Verifique se consegue pingar '8.8.8.8'. Se n\u00e3o conseguir, descubra como rotear os pacotes corretamente.</li> <li>Verifique se consegue pingar 'www.google.com'. Se n\u00e3o conseguir, descubra como resolver as urls corretamente.</li> <li> <p><code>$ sudo apt update &amp;&amp; sudo apt upgrade -y</code></p> </li> <li> <p><code>$ sudo snap install maas --channel=3.5/stable</code></p> </li> <li> <p><code>$ sudo snap install maas-test-db</code></p> </li> </ul> <p>Para acessar nossa m\u00e1quina remotamente, fazemos o acesso utilizando o ssh.</p> <p><code>ssh cloud@172.16.0.3</code></p>"},{"location":"roteiro1/main/#configurando-o-maas","title":"Configurando o MaaS","text":"<ul> <li>Inicializando o MaaS:<ul> <li><code>$ sudo maas init region+rack --maas-url http://172.16.0.3:5240/MAAS --database-uri maas-test-db:///</code></li> <li><code>$ sudo maas createadmin</code></li> <li>use o login cloud</li> <li>use a senha padr\u00e3o da disciplina</li> <li>deixe a chave vazia</li> </ul> </li> <li>Gerando um par de chaves para autentica\u00e7\u00e3o.<ul> <li><code>$ ssh-keygen -t rsa</code></li> <li>use senha vazia dessa vez</li> <li><code>$ cat ./.ssh/id_rsa.pub</code></li> <li>copie a chave gerada</li> </ul> </li> </ul> <p>Primeiramente, precisamos entender onde o servi\u00e7o est\u00e1 rodando e fazer login.</p> <ol> <li> <p>Configure um DNS Forwarder com o DNS do Insper (DNS Externo que o seu roteador enxerga)</p> <ul> <li>Acesse <code>Settings &gt; DNS</code></li> <li>Coloque o DNS do Insper: <code>172.20.129.131</code></li> </ul> </li> <li> <p>Importe as imagens do Ubuntu</p> <ul> <li>Em <code>Configuration &gt; Images</code></li> <li>Selecione Ubuntu 22.04 LTS com arquitetura amd64</li> <li>Selecione Ubuntu 20.04 LTS com arquitetura amd64 (clique em \"Update Selection\")</li> <li>Clique em \"Continue\" sem mexer em \"Other Images\"</li> <li>Finalize com \"Save and Finish Setup\"</li> </ul> </li> <li> <p>Fa\u00e7a o upload da chave SSH</p> <ul> <li>Copie a chave p\u00fablica do seu terminal SSH</li> <li>Inclua todo o conte\u00fado, desde <code>ssh-rsa</code> at\u00e9 o final com <code>cloud@main</code></li> <li>Em Source, escolha \"Upload\"</li> </ul> </li> <li> <p>Configure os par\u00e2metros do kernel</p> <ul> <li>Em <code>Settings &gt; General</code></li> <li>Global Kernel Parameters: <code>net.ifnames=0</code> (sem espa\u00e7os)</li> </ul> </li> </ol>"},{"location":"roteiro1/main/#configuracao-do-dhcp","title":"Configura\u00e7\u00e3o do DHCP","text":"<ol> <li> <p>Habilite o DHCP na subrede pelo MaaS Controller</p> <ul> <li>Acesse <code>Subnets</code> no dashboard</li> <li>Clique em <code>VLAN</code> em \"untagged\"</li> <li>Selecione \"Configure DHCP\"</li> <li>Selecione o Rack controller como \"main\"</li> <li>Coloque a subnet criada (172.16.0.0/20)</li> <li>Clique em \"Configure DHCP\"</li> <li>Confirme clicando em \"OK\"</li> </ul> </li> <li> <p>Altere o Reserved Range</p> <ul> <li>Configure para iniciar em <code>172.16.11.1</code> e terminar em <code>172.16.14.255</code></li> <li>Este range ficou configurado como din\u00e2mico</li> </ul> </li> <li> <p>Configure o DNS da subnet</p> <ul> <li>Mantenha apontando para o DNS do Insper</li> <li>Acesse <code>Subnet &gt; IP subnet &gt; Edit</code></li> </ul> </li> <li> <p>Desabilite o DHCP no roteador</p> <ul> <li>Acesse o IP do roteador: <code>172.16.0.1</code></li> <li>Navegue at\u00e9 <code>Network &gt; LAN &gt; DHCP Server</code></li> <li>Altere o status para \"Disable\"</li> <li>Salve as altera\u00e7\u00f5es</li> </ul> </li> </ol>"},{"location":"roteiro1/main/#verificacao-da-saude-do-maas","title":"Verifica\u00e7\u00e3o da Sa\u00fade do MaaS","text":"<p>Confirme a sa\u00fade do sistema MaaS:</p> <ol> <li>Visite a p\u00e1gina \"Controllers\" na interface web (dashboard)</li> <li>Selecione o nome do controlador</li> <li>Certifique-se de que a p\u00e1gina mostre uma marca de sele\u00e7\u00e3o verde ao lado dos itens 'regiond' at\u00e9 'dhcpd'</li> </ol> <p></p>"},{"location":"roteiro1/main/#comissionamento-de-servidores","title":"Comissionamento de Servidores","text":"<ol> <li> <p>Cadastre os hosts (machines) dispon\u00edveis, do server1 at\u00e9 server5</p> <ul> <li>Altere a op\u00e7\u00e3o Power Type para Intel AMT e preencha conforme abaixo:</li> <li>MacAddress: utilize o que foi anotado anteriormente</li> <li>Senha: <code>CloudComp6s!</code></li> <li>IP do AMT: <code>172.16.15.X</code> (sendo X o id do server, por exemplo server1 = 172.16.15.1)</li> </ul> </li> <li> <p>As NUCs ir\u00e3o comissionar automaticamente via boot PXE na rede</p> </li> <li> <p>Verifica\u00e7\u00e3o das caracter\u00edsticas de hardware:</p> <ul> <li>Server1: Caracter\u00edsticas a serem observadas</li> <li>Server2: 248,1GB no storage e 32GB de RAM</li> <li>Server3: 248,1GB no storage e 31GB de RAM</li> <li>Server4: 240,1GB no storage e 32GB de RAM</li> <li>Server5: 240,1GB no storage e 32GB de RAM</li> </ul> </li> <li> <p>Confirme que todos os n\u00f3s aparecem com o status Ready</p> <ul> <li>Verifique se as caracter\u00edsticas de hardware (cpu, mem\u00f3ria, SSD e rede) foram detectadas corretamente</li> </ul> </li> </ol>"},{"location":"roteiro1/main/#adicionando-o-roteador-como-device","title":"Adicionando o Roteador como Device","text":"<ol> <li>Acesse <code>Devices &gt; Add Device</code></li> <li>Configure:<ul> <li>Device Name: Roteador</li> <li>MAC Address: utilize o endere\u00e7o do roteador</li> <li>Para encontrar o MAC Address acesse <code>Dashboard do Roteador &gt; Network &gt; MAC &gt; Current MAC Address</code> (na linha de LAN)</li> </ul> </li> <li>Clique em \"Save device\"</li> </ol>"},{"location":"roteiro1/main/#criando-ovs-bridge","title":"Criando OVS Bridge","text":"<p>Uma Open vSwitch (OVS) bridge reduz a necessidade de duas interfaces de rede f\u00edsicas.</p> <p>Para cada servidor, execute este procedimento:</p> <ol> <li>Acesse <code>Machines</code></li> <li>Selecione cada servidor individualmente</li> <li>Navegue at\u00e9 <code>Network</code></li> <li>Selecione a interface <code>eth0</code></li> <li>Clique em \"Create bridge\"</li> <li>Mude o nome para <code>br-ex</code></li> <li>Coloque Bride Type como <code>Open vSwitch (OVS)</code></li> <li>Sete o <code>Auto-Assign</code></li> <li>Clique em \"Save interface\"</li> </ol> <p>O nome da ponte ser\u00e1 referenciado em outras partes dos roteiros. Neste exemplo de nuvem, utilizamos uma \u00fanica VLAN n\u00e3o etiquetada.</p> <p></p>"},{"location":"roteiro1/main/#configurando-acesso-remoto","title":"Configurando Acesso Remoto","text":"<p>Vamos realizar um NAT para permitir o acesso externo da \"Rede Wi-fi Insper\" ao servidor MAIN.</p> <ol> <li> <p>Crie uma regra NAT para acesso SSH:</p> <ul> <li>Acesse <code>Dashboard do roteador &gt; Transmission &gt; NAT &gt; Virtual Servers &gt; Add</code></li> <li>Configure portas interna e externa como 22</li> <li>O IP \u00e9 o da NUC main: <code>172.16.0.3</code></li> <li>A rede <code>0.0.0.0/0</code> representa \"libere o acesso sempre\"</li> </ul> </li> <li> <p>Libere o acesso ao gerenciamento remoto do roteador:</p> <ul> <li>Acesse <code>Dashboard do Roteador &gt; System Tools &gt; Admin Setup &gt; Remote Management</code></li> <li>Configure o IP como <code>0.0.0.0/0</code></li> <li>Status: Enable</li> </ul> </li> <li> <p>Registre os IPs importantes:</p> <ul> <li>IP FIXO DO ROTEADOR (EXTERNO): <code>10.103.1.22</code> (IP que o Insper enxerga)</li> <li>IP INTERNO DO ROTEADOR: <code>172.16.0.1</code></li> </ul> </li> <li> <p>Crie uma regra NAT para o MaaS:</p> <ul> <li>Configure de forma similar ao SSH, mas usando a porta 5240</li> <li>IP continua sendo o da NUC main: <code>172.16.0.3</code></li> </ul> </li> </ol>"},{"location":"roteiro1/main/#enderecos-ip-relevantes","title":"Endere\u00e7os IP Relevantes","text":"<p>Para refer\u00eancia e configura\u00e7\u00f5es futuras, registre os seguintes endere\u00e7os:</p> Descri\u00e7\u00e3o Endere\u00e7o Observa\u00e7\u00e3o IP externo do roteador <code>10.103.1.22</code> IP fixo vis\u00edvel pela rede do Insper IP interno do roteador <code>172.16.0.1</code> Gateway da rede interna Porta do servi\u00e7o MaaS <code>5240</code> Porta fixa do servi\u00e7o IP da NUC main <code>172.16.0.3</code> Servidor principal <p>Ap\u00f3s estas configura\u00e7\u00f5es, \u00e9 poss\u00edvel acessar tanto o roteador quanto o servi\u00e7o MaaS a partir de qualquer ponto conectado \u00e0 rede do Insper, eliminando a necessidade de conex\u00e3o f\u00edsica direta. O roteador atua como intermedi\u00e1rio, redirecionando as requisi\u00e7\u00f5es externas para os servi\u00e7os internos apropriados.</p> <p>Agora \u00e9 poss\u00edvel acessar o roteador de qualquer lugar do Insper pelo seu IP externo.</p>"},{"location":"roteiro1/main/#parte-2-aplicacao","title":"Parte 2: Aplica\u00e7\u00e3o","text":""},{"location":"roteiro1/main/#django-em-nuvem-bare-metal","title":"Django em Nuvem Bare-Metal","text":""},{"location":"roteiro1/main/#ajuste-no-dns-server","title":"Ajuste no DNS Server","text":"<p>Antes de come\u00e7ar, realize um pequeno ajuste no DNS server:</p> <ol> <li>Dentro da aba Subnets, clique na subnet <code>172.16.0.0/20</code></li> <li>Edite a Subnet summary colocando o DNS do Insper: <code>172.20.129.131</code></li> </ol>"},{"location":"roteiro1/main/#implantacao-do-banco-de-dados-postgresql","title":"Implanta\u00e7\u00e3o do Banco de Dados (PostgreSQL)","text":"<ol> <li> <p>Acesse o Dashboard do MaaS e realize o deploy do Ubuntu 22.04 no server1</p> <ul> <li>Navegue at\u00e9 <code>Machines &gt; Server1 &gt; Actions &gt; Deploy &gt; Deploy Machine</code></li> </ul> </li> <li> <p>Acesse o terminal do server1 via SSH:    <pre><code>ssh ubuntu@172.16.15.13  # IP_DO_SERVER1\n</code></pre></p> </li> <li> <p>Instale o PostgreSQL:    <pre><code>sudo apt update\nsudo apt install postgresql postgresql-contrib -y\n</code></pre></p> </li> <li> <p>Crie um usu\u00e1rio para a aplica\u00e7\u00e3o:    <pre><code>sudo su - postgres\ncreateuser -s cloud -W\n# Use a senha: cloud\n</code></pre></p> </li> <li> <p>Crie um database para a aplica\u00e7\u00e3o:    <pre><code>createdb -O cloud tasks\n</code></pre></p> </li> <li> <p>Configure o PostgreSQL para aceitar conex\u00f5es remotas:    <pre><code>nano /etc/postgresql/16/main/postgresql.conf\n</code></pre></p> <ul> <li>Remova o coment\u00e1rio e substitua a linha para aceitar conex\u00f5es remotas:    <pre><code>listen_addresses = '*'\n</code></pre></li> </ul> </li> <li> <p>Configure o acesso:    <pre><code>nano /etc/postgresql/16/main/pg_hba.conf\n</code></pre></p> <ul> <li>Adicione a linha que libera m\u00e1quinas dentro da subnet do kit:    <pre><code>host    all    all    172.16.0.0/20    trust\n</code></pre></li> </ul> </li> <li> <p>Saia do usu\u00e1rio postgres com o comando <code>exit</code></p> </li> <li> <p>Libere o firewall:    <pre><code>sudo ufw allow 5432/tcp\n</code></pre></p> </li> <li> <p>Reinicie o servi\u00e7o:     <pre><code>sudo systemctl restart postgresql\n</code></pre></p> </li> </ol> <p>Tarefa-1</p> <p>Estude os comandos ping, ifconfig, systemctl, telnet, ufw, curl, wget e journalctl. Com estes comandos apresente prints das Telas  que provam que o banco de dados est\u00e1:</p> <pre><code>1. Funcionando e seu Status est\u00e1 como \"Ativo\" para o Sistema Operacional\n2. Acessivel na pr\u00f3pria maquina na qual ele foi implantado.\n3. Acessivel a partir de uma conex\u00e3o vinda da m\u00e1quina MAIN.\n4. Em qual porta este servi\u00e7o est\u00e1 funcionando.\n</code></pre>"},{"location":"roteiro1/main/#1-funcionando-e-seu-status-esta-como-ativo-para-o-sistema-operacional","title":"1. Funcionando e seu Status est\u00e1 como \"Ativo\" para o Sistema Operacional.","text":""},{"location":"roteiro1/main/#2-acessivel-na-propria-maquina-na-qual-ele-foi-implantado","title":"2. Acessivel na pr\u00f3pria maquina na qual ele foi implantado.","text":""},{"location":"roteiro1/main/#3-acessivel-a-partir-de-uma-conexao-vinda-da-maquina-main","title":"3. Acessivel a partir de uma conex\u00e3o vinda da m\u00e1quina MAIN.","text":""},{"location":"roteiro1/main/#4-em-qual-porta-este-servico-esta-funcionando","title":"4. Em qual porta este servi\u00e7o est\u00e1 funcionando.","text":""},{"location":"roteiro1/main/#implantacao-da-aplicacao-django","title":"Implanta\u00e7\u00e3o da Aplica\u00e7\u00e3o Django","text":"<ol> <li> <p>Volte ao MaaS e solicite uma m\u00e1quina via CLI:    <pre><code>maas login cloud http://172.16.0.3:5240/MAAS/\n</code></pre></p> <ul> <li>Busque o token no dashboard dentro das configura\u00e7\u00f5es do usu\u00e1rio: <code>Cloud &gt; API Keys</code></li> </ul> </li> <li> <p>Solicite a reserva da m\u00e1quina para o MaaS:    <pre><code>maas cloud machines allocate name=server2\n</code></pre></p> <ul> <li>Anote o system_id do JSON resultante (no nosso caso: <code>ew8g34</code>)</li> </ul> </li> <li> <p>Realize o deploy via linha de comando:    <pre><code>maas cloud machine deploy ew8g34\n</code></pre></p> </li> <li> <p>Ap\u00f3s o deploy, acesse o servidor via SSH (IP: <code>172.16.15.14</code>):    <pre><code>ssh ubuntu@172.16.15.14\n</code></pre></p> </li> <li> <p>Clone o reposit\u00f3rio da aplica\u00e7\u00e3o:    <pre><code>git clone https://github.com/raulikeda/tasks.git\ncd tasks/\n</code></pre></p> </li> <li> <p>Configure o banco de dados:</p> <ul> <li>Edite o arquivo de configura\u00e7\u00e3o do Django:    <pre><code>nano portfolio/settings.py\n</code></pre></li> <li>Altere a configura\u00e7\u00e3o do banco de dados para apontar para o IP do server1:    <pre><code>DATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql',\n        'NAME': 'nome_do_banco',\n        'USER': 'usuario',\n        'PASSWORD': 'senha',\n        'HOST': '172.16.15.13',  # IP do server1\n        'PORT': '5432',\n    }\n}\n</code></pre></li> <li>ou abra o arquivo     <pre><code>nano /etc/hosts\n</code></pre>    E adicione o endere\u00e7amento do server1 ao seu IP.</li> </ul> </li> <li> <p>Execute o script de instala\u00e7\u00e3o:    <pre><code>./install.sh\n</code></pre></p> </li> <li> <p>Reinicie o servidor:    <pre><code>sudo reboot\n</code></pre></p> </li> <li> <p>Teste o acesso ao servi\u00e7o:    <pre><code>wget http://172.16.15.14:8080/admin/\n</code></pre></p> </li> </ol> <p></p>"},{"location":"roteiro1/main/#criando-um-tunel-ssh-para-acesso-externo","title":"Criando um T\u00fanel SSH para Acesso Externo","text":"<p>Para acessar o servi\u00e7o no seu navegador:</p> <ol> <li> <p>Desconecte do SSH do MaaS com o comando <code>exit</code></p> </li> <li> <p>Reconecte criando um t\u00fanel SSH:    <pre><code>ssh cloud@10.103.1.22 -L 8001:172.16.15.7:8080\n</code></pre></p> </li> </ol> <p>Este comando cria um t\u00fanel do servi\u00e7o do server2 na porta 8080 para o seu localhost na porta 8001.</p> <ol> <li>Acesse no navegador: <code>http://localhost:8001/admin/</code></li> <li>Login Django: <code>cloud</code></li> <li>Senha Django: <code>cloud</code></li> </ol> <p></p> <p>Um t\u00fanel SSH \u00e9 uma conex\u00e3o segura que permite redirecionar dados de uma m\u00e1quina remota para sua m\u00e1quina local. Ele funciona como um \"canal secreto\" criptografado, protegendo a comunica\u00e7\u00e3o contra intercepta\u00e7\u00f5es.</p> <p>Tarefa-2</p> <p>De um print das Telas abaixo:</p> <pre><code>1. Do Dashboard do **MAAS** com as m\u00e1quinas.\n2. Da aba images, com as imagens sincronizadas.\n3. Da Aba de cada maquina(5x) mostrando os testes de hardware e commissioning com Status \"OK\"\n</code></pre>"},{"location":"roteiro1/main/#1-do-dashboard-do-maas-com-as-maquinas","title":"1. Do Dashboard do MAAS com as m\u00e1quinas.","text":""},{"location":"roteiro1/main/#2-da-aba-images-com-as-imagens-sincronizadas","title":"2. Da aba images, com as imagens sincronizadas.","text":""},{"location":"roteiro1/main/#3-da-aba-de-cada-maquina5x-mostrando-os-testes-de-hardware-e-commissioning-com-status-ok","title":"3. Da Aba de cada maquina(5x) mostrando os testes de hardware e commissioning com Status \"OK\"","text":""},{"location":"roteiro1/main/#implantacao-automatizada-com-ansible","title":"Implanta\u00e7\u00e3o Automatizada com Ansible","text":"<p>Para aumentar a disponibilidade da aplica\u00e7\u00e3o, vamos implementar uma segunda inst\u00e2ncia da aplica\u00e7\u00e3o Django:</p> <ol> <li> <p>Fa\u00e7a o deploy do Ubuntu 22.04 no server3 via dashboard do MaaS</p> </li> <li> <p>No SSH do main, instale o Ansible:    <pre><code>sudo apt install ansible\nwget https://raw.githubusercontent.com/raulikeda/tasks/master/tasks-install-playbook.yaml\n</code></pre></p> </li> <li> <p>Execute o playbook do Ansible:    <pre><code>ansible-playbook tasks-install-playbook.yaml --extra-vars server=172.16.15.15  # IP do server3\n</code></pre></p> </li> </ol> <p>A diferen\u00e7a entre a instala\u00e7\u00e3o manual e com Ansible \u00e9 que manualmente precisamos pedir uma m\u00e1quina ao MaaS, solicitar uma reserva, deployar e instalar via script, o que \u00e9 trabalhoso e n\u00e3o automatizado. Com o Ansible, realizamos a instala\u00e7\u00e3o de forma autom\u00e1tica, pois ele j\u00e1 \u00e9 um gerenciador de deploy - basta fornecer o arquivo YAML com os requisitos.</p>"},{"location":"roteiro1/main/#balanceamento-de-carga-com-proxy-reverso","title":"Balanceamento de Carga com Proxy Reverso","text":"<p>Para criar um ponto \u00fanico de entrada e distribuir a carga entre os servidores, vamos implementar um proxy reverso com Nginx:</p> <ol> <li> <p>Fa\u00e7a o deploy do Ubuntu no server4 via dashboard do MaaS</p> </li> <li> <p>Acesse o server4 via SSH e instale o Nginx:    <pre><code>sudo apt-get update\nsudo apt-get install nginx\n</code></pre></p> </li> <li> <p>Configure o m\u00f3dulo upstream:    <pre><code>sudo nano /etc/nginx/sites-available/default\n</code></pre></p> </li> <li> <p>Adicione a configura\u00e7\u00e3o de balanceamento de carga:    <pre><code>upstream backend {\n    server 172.16.15.7:8080;  # IP do server2\n    server 172.16.15.15:8080; # IP do server3\n}\n\nserver {\n    location / {\n        proxy_pass http://backend;\n    }\n}\n</code></pre></p> </li> <li> <p>Reinicie o Nginx:    <pre><code>sudo service nginx restart\n</code></pre></p> </li> <li> <p>Modifique a mensagem de cada servidor Django para identifica\u00e7\u00e3o:</p> </li> <li>Edite o arquivo <code>tasks/views.py</code> em cada servidor:    <pre><code>nano tasks/views.py\n</code></pre></li> <li> <p>Altere a mensagem para incluir o nome do servidor:    <pre><code>from django.shortcuts import render\nfrom django.http import HttpResponse\n\ndef index(request):\n    return HttpResponse(\"Hello, world. You're at the tasks index (on server2).\")  # ou server3\n</code></pre></p> </li> <li> <p>Edite o arquivo <code>urls.py</code> para customizar o path:    <pre><code>urlpatterns = [path('', views.index, name='index'),]\n</code></pre></p> </li> <li> <p>Teste o acesso ao proxy reverso, verificando que ele alterna entre os servidores.</p> </li> </ol> <p>Tarefa-5</p> <p>Teste o acesso, caso esteja tudo certo, fa\u00e7a a tarefa abaixo:</p> <pre><code>1. De um print da tela do Dashboard do MAAS com as 4 Maquinas e seus respectivos IPs.\n2. Altere o conte\u00fado da mensagem contida na fun\u00e7\u00e3o `index` do arquivo `tasks/views.py` de cada server para distinguir ambos os servers. \n3. Fa\u00e7a um `GET request` para o path que voce criou em urls.py para o Nginx e tire 2 prints das respostas de cada request, provando que voce est\u00e1 conectado ao server 4, que \u00e9 o Proxy Reverso e que ele bate cada vez em um server diferente server2 e server3.\n</code></pre>"},{"location":"roteiro1/main/#1-de-um-print-da-tela-do-dashboard-do-maas-com-as-4-maquinas-e-seus-respectivos-ips","title":"1. De um print da tela do Dashboard do MAAS com as 4 Maquinas e seus respectivos IPs.","text":""},{"location":"roteiro1/main/#2-altere-o-conteudo-da-mensagem-contida-na-funcao-index-do-arquivo-tasksviewspy-de-cada-server-para-distinguir-ambos-os-servers","title":"2. Altere o conte\u00fado da mensagem contida na fun\u00e7\u00e3o <code>index</code> do arquivo <code>tasks/views.py</code> de cada server para distinguir ambos os servers.","text":""},{"location":"roteiro1/main/#3-faca-um-get-request-para-o-path-que-voce-criou-em-urlspy-para-o-nginx-e-tire-2-prints-das-respostas-de-cada-request-provando-que-voce-esta-conectado-ao-server-4-que-e-o-proxy-reverso-e-que-ele-bate-cada-vez-em-um-server-diferente-server2-e-server3","title":"3. Fa\u00e7a um <code>GET request</code> para o path que voce criou em urls.py para o Nginx e tire 2 prints das respostas de cada request, provando que voce est\u00e1 conectado ao server 4, que \u00e9 o Proxy Reverso e que ele bate cada vez em um server diferente server2 e server3.","text":""},{"location":"roteiro1/main/#conclusao","title":"Conclus\u00e3o","text":"<p>Neste roteiro, configuramos com sucesso:</p> <ol> <li>Um controlador MaaS para gerenciar nossa infraestrutura bare-metal</li> <li>Uma rede com DHCP controlado pelo MaaS</li> <li>Um servidor de banco de dados PostgreSQL</li> <li>Duas inst\u00e2ncias de uma aplica\u00e7\u00e3o Django</li> <li>Um balanceador de carga com Nginx para distribuir o tr\u00e1fego</li> </ol>"},{"location":"roteiro2/main/","title":"Roteiro 2","text":""},{"location":"roteiro2/main/#objetivo","title":"Objetivo","text":"<p>Aqui vai o objetivo macro do roteiro. Por que estamos fazendo o que estamos fazendo?</p>"},{"location":"roteiro2/main/#montagem-do-roteiro","title":"Montagem do Roteiro","text":"<p>Os pontos \"tarefas\" s\u00e3o os passos que devem ser seguidos para a realiza\u00e7\u00e3o do roteiro. Eles devem ser claros e objetivos. Com evid\u00eancias claras de que foram realizados.</p>"},{"location":"roteiro2/main/#tarefa-1","title":"Tarefa 1","text":"<p>Instalando o MAAS:</p> sudo snap install maas --channel=3.5/Stable <p></p> <p>Dashboard do MAAS</p> <p>Conforme ilustrado acima, a tela inicial do MAAS apresenta um dashboard com informa\u00e7\u00f5es sobre o estado atual dos servidores gerenciados. O dashboard \u00e9 composto por diversos pain\u00e9is, cada um exibindo informa\u00e7\u00f5es sobre um aspecto espec\u00edfico do ambiente gerenciado. Os pain\u00e9is podem ser configurados e personalizados de acordo com as necessidades do usu\u00e1rio.</p>"},{"location":"roteiro2/main/#tarefa-2","title":"Tarefa 2","text":""},{"location":"roteiro2/main/#app","title":"App","text":""},{"location":"roteiro2/main/#tarefa-1_1","title":"Tarefa 1","text":""},{"location":"roteiro2/main/#tarefa-2_1","title":"Tarefa 2","text":"<p>Exemplo de diagrama</p> <pre><code>architecture-beta\n    group api(cloud)[API]\n\n    service db(database)[Database] in api\n    service disk1(disk)[Storage] in api\n    service disk2(disk)[Storage] in api\n    service server(server)[Server] in api\n\n    db:L -- R:server\n    disk1:T -- B:server\n    disk2:T -- B:db</code></pre> <p>Mermaid</p>"},{"location":"roteiro2/main/#questionario-projeto-ou-plano","title":"Question\u00e1rio, Projeto ou Plano","text":"<p>Esse se\u00e7\u00e3o deve ser preenchida apenas se houver demanda do roteiro.</p>"},{"location":"roteiro2/main/#discussoes","title":"Discuss\u00f5es","text":"<p>Quais as dificuldades encontradas? O que foi mais f\u00e1cil? O que foi mais dif\u00edcil?</p>"},{"location":"roteiro2/main/#conclusao","title":"Conclus\u00e3o","text":"<p>O que foi poss\u00edvel concluir com a realiza\u00e7\u00e3o do roteiro?</p>"}]}